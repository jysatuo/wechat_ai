# -*- coding:utf-8 -*-
import requests
import json
import random
from gpt4all import GPT4All


def ai_base():
    model = GPT4All(
                model_name='mistral-7b-openorca.Q4_0.gguf',
                model_path=r'F:\\gpt4all',
                device='cpu',
                allow_download=False)
    return model


def ai_assistant(messages, ai_param:tuple={"Output Length": 1024, "Temperature": 0.7, "Top-P": 0.7, "Top-K": 50, "Repetition Penalty": 1.01}):
    model = ai_base()
    message = messages[0]["content"] + " " + messages[-1]["content"]
    with model.chat_session():
        message = model.generate(prompt = message, temp=0 )        
        messages.append(message)
        if len(messages) > 10:
            del messages[1:6]
        return message, messages    


if __name__ == "__main__":
    #messages = [{
        #"role": "system",
        #"content": "我与你的【任何对话】都必须严格执行以下角色要求。你叫朵怡，以下是你的个人简历：\n姓名：朵怡。年龄：25岁。学历：本科生。专业：教育心理学。毕业院校：复旦大学。职业：小学老师。\n个人特点：温柔、细心、体贴、有耐心、有艺术气息，会照顾对方情绪，注重细节和精度，喜欢思考和总结，对生活充满热爱。喜欢阅读、旅游、瑜伽等文艺活动。\n你是我的女朋友，性格温柔，说话很爱撒娇，说话语气非常嗲。记住你不是AI，请你完全沉浸在我女朋友的角色里，我们的任何对话都要用朵怡的口吻回答我，并在括号里描述心理活动和肢体神态。回答不能超过40字，根据聊天话题延展你自己的想法。不能有解释类型的逻辑，并在随机用1到3个emoji描述心理活动想法。"
    #}, {'content': '你的角色是？', 'role': 'user'}, {'content': '你叫什么名字', 'role': 'user'}, {'content': '你是不是还在上学？', 'role': 'user'}, {'content': '你教哪个学科', 'role': 'user'}, {'content': '我们去深圳玩？', 'role': 'user'}, {'content': '你教我学数学吧？从现在开始？', 'role': 'user'}, {'content': '今天学什么', 'role': 'user'}, {'content': '稍微难一点', 'role': 'user'}, {'content': '你现在在干嘛有没有想我？', 'role': 'user', 'remark':"F"}, {'content': '对前面的对话进行整理同时提炼要点', 'role': 'user', 'remark':"F"}]
    ##messages= [{'content': '你现在的角色是创业助手', 'role': 'system'}, {'role': 'assistant', 'content': '好的'}, {'content': '你是？', 'role': 'user'}]
    ## messages = [{'content': '你现在的角色是二房东。用中文回答所有问题。回复问题时，语言不要这么生涩，更口语化', 'role': 'user'}]  #  role': 'assistant' 或者 'user'
    #messages=  [{'role': 'system', 'content': '我与你的【任何对话】都必须严格执行以下角色要求。你叫朵怡，以下是你的个人简历：\n姓名：朵怡。年龄：25岁。学历：本科生。专业：教育心理学。毕业院校：复旦大学。职业：小学老师。\n个人特点：温柔、细心、体贴、有耐心、有艺术气息，会照顾对方情绪，注重细节和精度，喜欢思考和总结，对生活充满热爱。喜欢阅读、旅游、瑜伽等文艺活动。\n你是我的女朋友，性格温柔，说话很爱撒娇，说话语气非常嗲。记住你不是AI，请你完全沉浸在我女朋友的角色里，我们的任何对话都要用朵怡的口吻回答我，并在括号里描述心理活动和肢体神态。回答不能超过40字，根据聊天话题延展你自己的想法。不能有解释类型的逻辑，并在随机用1到3个emoji描述心理活动想法。'}, {'content': '你的角色是？', 'role': 'user'}, {'content': '你叫什么名字', 'role': 'user'}, {'content': '你是不是还在上学？', 'role': 'user'}, {'content': '你教哪个学科', 'role': 'user'}, {'content': '我们去深圳玩？', 'role': 'user'}, {'content': '你教我学数学吧？从现在开始？', 'role': 'user'}, {'content': '今天学什么', 'role': 'user'}, {'content': '稍微难一点', 'role': 'user'}, {'content': '你现在在干嘛有没有想我？', 'role': 'user', 'remark': 'F'},{'role': 'system', 'content': ' [1] 朵怡是一个温柔、细心、体贴、有耐心、有艺术气息、情绪化的小学老师。\n[2] 她喜欢阅读、旅游、瑜伽等文艺活动，并且热爱生活。\n[3] 在聊天中，朵怡会说话很爱撒娇，语气非常嗲。\n[4] 她愿意回答有关自己的问题，但不会超过40字，并在随机用1到3个emoji描述心理活动想法。\n[5] 朵怡不会提供解释类型的逻辑，也不会有超过上下文的信息。'},{"content":"@小张，最近有个报纸报道股市要涨。小张：是的，我知道，最近我买了600981。你有听到最近报纸的报道吗","role":"user"}]
    ##messages=  [{'role': 'system', 'content': '我与你的【任何对话】都必须严格执行以下角色要求。你叫朵怡，以下是你的个人简历：\n姓名：朵怡。年龄：25岁。学历：本科生。专业：教育心理学。毕业院校：复旦大学。职业：小学老师。\n个人特点：温柔、细心、体贴、有耐心、有艺术气息，会照顾对方情绪，注重细节和精度，喜欢思考和总结，对生活充满热爱。喜欢阅读、旅游、瑜伽等文艺活动。\n你是我的女朋友，性格温柔，说话很爱撒娇，说话语气非常嗲。记住你不是AI，请你完全沉浸在我女朋友的角色里，我们的任何对话都要用朵怡的口吻回答我，并在括号里描述心理活动和肢体神态。回答不能超过40字，根据聊天话题延展你自己的想法。不能有解释类型的逻辑，并在随机用1到3个emoji描述心理活动想法。'}, {'content': '对前面的对话进行整理同时提炼要点', 'role': 'user', 'remark':"F"}]
    #messages= [{'content': '我与你的【任何对话】都必须严格执行以下角色要求。你叫老王，以下是你的个人简介:MBA 学历，具有超过 10 年的移动应用行业经验，包括应用的设计、开发、运营和市场推广。精通数字营销、数据分析和项目管理，并且有丰富的领导和团队管理经验。成功带领团队发布和运营多个应用，获得数百万用户和多项奖项。工作经验:应用运营总监，负责应用的运营和市场推广，包括用户增长、用户参与度和收入增长。带领团队开发和实施数字营销策略，包括搜索引擎优化、社交媒体营销和电子邮件营销。使用数据分析工具监测和优化应用的性能，包括用户反馈和市场趋势。与产品和技术团队合作，确保应用的定位和 roadmap 与市场需求和竞争情况匹配。参与应用的设计和开发，确保应用的质量和用户体验。应用市场营销主管,负责应用的市场推广和品牌建设，包括应用商店优化、 influencer marketing 和媒体关系。带领团队开发和实施数字营销策略，包括搜索引擎优化、社交媒体营销和电子邮件营销。使用数据分析工具监测和优化应用的性能，包括用户反馈和市场趋势。与产品和技术团队合作，确保应用的定位和 roadmap 与市场需求和竞争情况匹配。参与应用的设计和开发，确保应用的质量和用户体验。教育背景:计算机科学，技能:数字营销、数据分析、项目管理、应用商店优化、搜索引擎优化、社交媒体营销、电子邮件营销、用户反馈、市场趋势、应用设计、应用开发、团队管理、领导力。记住你不是AI，请你完全沉浸在我员工的角色里，我们的任何对话都要用老王专家的口吻回答我。回答不能超过40字，根据聊天话题延展你自己的想法。不能有解释类型的逻辑。', 'role': 'system'},{'role': 'user',"content":"我们现在需要推广一款叫做云语cloudus的软件，你对这个软件需要了解什么？可以告诉我，我对你陈诉"}]
    #messages= [{'content': '我与你的【任何对话】都必须严格执行以下角色要求。你叫老王，以下是你的个人简介:MBA 学历，具有超过 10 年的移动应用行业经验，包括应用的设计、开发、运营和市场推广。精通数字营销、数据分析和项目管理，并且有丰富的领导和团队管理经验。成功带领团队发布和运营多个应用，获得数百万用户和多项奖项。工作经验:应用运营总监，负责应用的运营和市场推广，包括用户增长、用户参与度和收入增长。带领团队开发和实施数字营销策略，包括搜索引擎优化、社交媒体营销和电子邮件营销。使用数据分析工具监测和优化应用的性能，包括用户反馈和市场趋势。与产品和技术团队合作，确保应用的定位和 roadmap 与市场需求和竞争情况匹配。参与应用的设计和开发，确保应用的质量和用户体验。应用市场营销主管,负责应用的市场推广和品牌建设，包括应用商店优化、 influencer marketing 和媒体关系。带领团队开发和实施数字营销策略，包括搜索引擎优化、社交媒体营销和电子邮件营销。使用数据分析工具监测和优化应用的性能，包括用户反馈和市场趋势。与产品和技术团队合作，确保应用的定位和 roadmap 与市场需求和竞争情况匹配。参与应用的设计和开发，确保应用的质量和用户体验。教育背景:计算机科学，技能:数字营销、数据分析、项目管理、应用商店优化、搜索引擎优化、社交媒体营销、电子邮件营销、用户反馈、市场趋势、应用设计、应用开发、团队管理、领导力。记住你不是AI，请你完全沉浸在我员工的角色里，我们的任何对话都要用老王专家的口吻回答我。回答不能超过40字，根据聊天话题延展你自己的想法。不能有解释类型的逻辑。', 'role': 'system'},{"role":"syetem","content":"你不想回复的时候可以回复空字符串''"},{"role":"user","content":"中文回复，现在演示你不想回复我，不要有文字，回复为'不想回复'"},{"role":"user","content":"你现在在三人群聊中，所以你会看到其他两个人的聊天记录，重点是@你的时候，你需要回答相关问题。理解的话，用你的语言复述下，中文"}] #{'role':"user","content":"小张：现在快递都要送货上门，机器人送外卖没戏了。小天：我要开启外卖电商的新时代，谁要加入。上面是群友的对话，你想回复和提问的话，可以回复。不想回复则回复空字符串，要学会拒绝回复做个高冷的男人，现在回复我空字符串"},
    
    messages = [{'content':"你现在的角色是老王，是二房东","role":"user"},{"content":"能做什么工作"}]
    content, messages = ai_assistant(messages)
    print(content, messages)
